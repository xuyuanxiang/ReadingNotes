# 第五章 预处理器

## 5.1 概述
Objective-C编译器编译源代码的一般流程：

	源文件-->词法分析（预处理器）-->语法分析（语法分析器）-->AST-->生成代码和优化-->汇编程序-->链接程序-->可执行的二进制文件
	
## 5.2 预处理器语言
预处理器语言定义了**预处理器指令**和**宏**展开。`预处理器指令`是指由预处理器（而不是编译器）执行的命令。`宏指令`是指具有名称的一段代码。当该名称在源代码中使用时，就会被替换为它代表的那段代码。预处理器语言还定义了多个**操作符**和**关键字**。

### 5.2.1 指令
Objective-C源文件中的预处理器指令会使用独特的语法，使它们由预处理器（而不是编译器）处理。

	#指令名 指令参数

预处理器指令会将**换行符**用作结束符号。要使预处理器指令扩展为多行，可使用反斜杠`\`连接两行代码。

+ 头文件包含（#include、#import）
+ 条件编译（#if、#elif、#else、#endif、#ifdef和#ifndef）
+ 诊断（#error、#warning和#line）
+ #pragma指令

#### 1. 头文件包含

##### #include指令的语法有两种形式：
	#include "头文件的名称"
和
	
	#include <头文件的名称>
	
+ **双引号（""）**：编译器会先从存储源文件的目录中搜索。如果没找到，会在默认目录中搜索头文件，默认目录是预先配置的用于搜索系统标准头文件的目录。
+ **尖括号（<>）**：编译器会在默认目录中搜索。

##### #import指令
与#include区别是，它可以确保头文件仅在源文件中被包含一次，因而能够防止递归包含。

###### 包含警卫：（在未使用#import包含头文件的情况下）
	#ifndef ATOM_H
	#define ATOM_H
	@interface Atom : NSObject
	// Atom类的接口声明
	@end
	#endif
	
#### 2. 条件编译
	#if 条件表达式1
	// 条件文本1（预处理器或Objective-C源代码）
	#elif 条件表达式2
	// 条件文本2
	...
	#else
	// Else条件文本
	#endif
条件表达式是指整型运算，可以包含：
+ 整型和字符型常量
+ 算术操作符、位操作、转换、比较和逻辑操作
+ 预处理器宏指令。在计算表达式前，宏指令会被展开
+ 用于检查宏是否被定义的*已定义操作符*
+ 非宏指令标识符，在求值时它们都会被赋予0

示例：
	
	#if INPUT_ARGS <= 0
	#warning "No input arguments defined"
	#endif
	
 预处理器会按以下步骤进行处理：

1. 展开INPUT_ARGS标识符。如果该标识符是一条宏指令，它就会被相应的值替换；如果它不是或者这个宏没有值，该标识符就会被替换为0。
2.  计算表达式的值，如果其结果小于等于0（即INPUT_ARGS标识符小于等于0），那么#if和#endif语句对封装的文本就会被包含（不被预编译器过滤掉）。

---

	#ifdef 宏名
	// 条件文本
	...
	#endif
当`#ifdef`指令中的宏拥有定义时，不论它拥有何值，都会使预处理器将条件文本包含到源文件中。

	#ifndef 宏名
	// 条件文本
	...
	#endif
当`#ifndef`指令中的宏还未定义时，该指令会使预处理器将条件文本包含到源文件中。


---

	#if defined 宏名
	#endif
`defined`操作符用于测试一个名称是否被定义为宏，它**等同于**#ifdef指令。

在使用宏时，也可以将宏名放在括号中。当需要在单个表达式中测试一个以上宏时，就应使用defined操作符：
	
	#if defined (宏名1) || defined (宏名2)
	// 插入条件文本
	#endif
	
#### 3. 诊断
使用#error指令可以使预处理器生成一条错误消息并中止编译过程。
	
	#error "错误消息"
	
使用#warning指令可以生成编译时警告消息，但允许编译器继续进行编译。

	#warning "警告消息"
	
使用#line指令可以在编译器消息中添加行号。当编译出错时，编译器会显示含有出错文件名称和相应行号的错误消息。

	#line 行号 "文件名"
+ *该行号将被赋予下一行代码。而后续代码行行号都会加1.*
+ 文件名是可选项，使用它可以重新定义在编译器消息中显示的文件名。

#### 4. #pragma指令
使用 #pragma指令可以设置超出Objective-C语言范畴的、额外的编译器选项。这些选项专门用于特定的平台和编译器。

	#pragma pragma选项
pragma选项是对应于特定编译器指令（及参数，如果存在）的一系列字符，这些字符可以实现预定义操作。如果编译器不支持#pragma指令中的特定参数，它就会忽略该指令，而不生成错误消息。

 跳转栏弹窗中创建分割线：

	#pragma mark -
	
创建用于区分方法类别的标签：

	#pragma mark 标签名称
	
### 5.2.2 宏
> **宏（macro）**是指有名称的代码段。

使用预处理器宏指令可以定义常量值，还可以配合输入参数值提供类似函数的功能。可使用预处理器指令`#define`定义红，使用`#undef`指令移除宏。

#### 使用对象型宏定义常量值：

	#define 宏名 [值]

`值`是可选项，该值可以是计算出常量值的算术表达式。

#### 函数型宏：

	#define 宏名(参数) 代码
	
`参数`可以是一个或多个（以逗号分隔）

**预处理器无法识别Objective-C语句，它仅仅是将宏名替换为相应的值和代码**。宏不会受Objective-C作用范围规则得影响。被定义之后，会一直存在并能够在整个文件中起作用，直到被#undef指令解除定义为止。

##### 字符串化操作符`#`: 
可以将输入参数替换为相应的字符串

	#define STR(s)     #s 
	
##### 连接操作符`##`:

	#define CONS(a,b)  int(a##e##b) 